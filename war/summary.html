<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

   
  <div id="summary">
            <div   style=" width:200px;float:left;">
                <h2 class="ui-widget-header ui-corner-all" style="margin: 0; padding: 5px;">Highlights</h2>
                <div><table id="additionaldetails" class="module" align="center" border="0" style="width:200px; float:left;padding:5px;">
                        <tr>
                            <td class="cellheader">Strategist</td> 
                            <td class="cellformat"><span id="s-strategist" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader"><span >Market</span></td> 
                            <td class="cellformat"><span id="s-market" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Currency</span></td> 
                            <td class="cellformat"><span id="s-currency" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Traded Instrument</span></td> 
                            <td class="cellformat"><span id="s-instrument" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Initial Balance</span></td> 
                            <td class="cellformat"><span id="s-initialbalance" > </span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Current Balance</span></td> 
                            <td class="cellformat"><span id="s-currentbalance" > </span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Start Date</span></td> 
                            <td class="cellformat"><span id="s-started" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Current Followers</span></td> 
                            <td class="cellformat"><span id="s-followers" ></span></td> 
                        </tr>
                        
                        
                    </table></div>
            </div>
           <div style=" width:200px;float:left;margin-left:10px;">
                <h2 class="ui-widget-header ui-corner-all" style="margin: 0; padding: 5px;">Key Statistics</h2>
                <div> <table id="statistics" class="module" border="0"  align="center" style="width:200px;padding:5px;" > 
                    <tr>
                            <td class="cellheader">Overall Return(%)</td> 
                            <td class="cellformat"><span id="s-overallreturn" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader"><span >Profit Factor</span></td> 
                            <td class="cellformat"><span id="s-profitfactor" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >3 Months Return(%)</span></td> 
                            <td class="cellformat"><span id="s-3mreturn" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Avg. Win</span></td> 
                            <td class="cellformat"><span id="s-avgwin" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Avg. Loss</span></td> 
                            <td class="cellformat"><span id="s-avgloss" > </span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Trade Count</span></td> 
                            <td class="cellformat"><span id="s-tradecount" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Profitable Trade</span></td> 
                            <td class="cellformat"><span id="s-profittradecount" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Loosing Trade</span></td> 
                            <td class="cellformat"><span id="s-loosingtradecount" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Max Draw Down</span></td> 
                            <td class="cellformat"><span id="s-maxdrawdown" ></span></td> 
                        </tr>
                        <tr>
                            <td class="cellheader "><span >Strategy Tracked (days)</span></td> 
                            <td class="cellformat"><span id="s-age" ></span></td> 
                        </tr>
                    </table></div>
            </div>
      
            <div id="desc-block" class="module" style="padding:7px;width:250px;float:left;margin-left:10px;font-size:1.3em;background-color: #DDEEF6;">
               
            </div>
      
            <div id="sub-block" class="module" style="width:264px;float:left;margin-left:10px;margin-top:20px;background-color: #F4F4F4">
                <div> 
                    <table id="sub-tab"  border="0"  align="center" style="padding:5px;" > 
                    <tr>
                            <td style="text-align: left;font-size: 15px;">Trial Period (days)</td> 
                            <td class="cellformat"><span id="s-trial" ></span></td> 
                        </tr>
                        <tr>
                            <td style="text-align: left;font-size: 15px;"><span >Monthly Fee:</span></td> 
                            <td class="cellformat"><span id="s-fee" ></span></td> 
                        </tr>
                       
                    </table>
                    <div id="free-block" style="padding:20px 60px;"><span style="font-size: 15px;color:#39C;width:264px;font-weight: bolder;">Follow for Free!</span></div>
                </div>
                <div id="s-follow"></div>
            </div>
            
            <div id="champ-block" class="module" style="width:264px;float:left;margin-left:10px;margin-top:20px;background-color: #DDEEF6;">
                <table border="0"  align="center" style="padding:5px;" > 
                        
                    <tr>
                            <td style="text-align: left;font-size: 15px;">Ranking</td> 
                            <td class="cellformat"><span id="s-ranking" ></span></td> 
                        </tr>
                    <tr>
                            <td style="text-align: left;font-size: 15px;">Prize Money</td> 
                            <td class="cellformat"><span id="s-prize" ></span></td> 
                        </tr>
                        <tr>
                            <td style="text-align: left;font-size: 15px;"><span >Start Date</span></td> 
                            <td class="cellformat"><span id="s-cstartdate" ></span></td> 
                        </tr>
                        <tr>
                            <td style="text-align: left;font-size: 15px;"><span >End Date</span></td> 
                            <td class="cellformat"><span id="s-cenddate" ></span></td> 
                        </tr></table>
                <div id="champ-link" style="clear:both;float:left;margin-left: 60px;"></div>
                <div style="padding:10px;clear:both;">*Ranking will be updated by the end of the day.</div>
            </div>
      
      
           
            <div class="module" style=" padding:5px;width:700px;float:left;clear:right;margin-left: auto;margin-right:auto;">
                <h2 class="ui-widget-header ui-corner-all" style="margin: 0; padding: 5px;">Hypothetical Return on Investment</h2>
               
                <div> <table id="mreturn" border="2" align="center" style="width:690px;float:left;" > </table></div>
            </div>

             <div  class="ui-widget-content ui-corner-all" style="margin-top:10px;padding:0px; width:650px;float:left;clear:right;">
                <h2 class="ui-widget-header ui-corner-all" style="margin: 0; padding: 5px;">Drawdown of Equity</h2>
		<div id="dd" align="center" style="height:250px;width:600px; float:left;margin: 20px;"></div>
            </div>
           
      
            

            <div  class="ui-widget-content ui-corner-all" style="margin-top:10px;padding:0px; width:650px;float:left;clear:right;">
                <h2 class="ui-widget-header ui-corner-all" style="margin: 0; padding: 5px;;">Historical Cash/Equity</h2>
		 <div id="cash-eq" align="center" style="height:250px;width:600px; float:left;margin: 20px;"></div>
            </div>

            <div  class="ui-widget-content ui-corner-all" style="margin-top:10px;margin-left: 150px;padding:0px; width:430px;float:left;clear:right;">
                <h2 class="ui-widget-header ui-corner-all" style="margin: 0; padding: 5px;">Investment Breakdown by Sector</h2>
		<div id="sector" align="center" style="height:400px;width:400px;float:left;margin:5px; "></div>
            </div>
  </div>
   <script >
        jQuery('#summary').ready(function(){
            
            $('#desc-block, #sub-block, #champ-block, #free-block, #sub-tab').hide();
           
            //console.log(currstrategy.type);
            if(currstrategy != null && currstrategy.type == Constants.Strategy.TYPE_CHAMPIONSHIP){
                
                $('#champ-block').show();
                
                $.ajax({
                        type: "post",
                        url: "publicdatahandle",
                        dataType: "json",
                        data:'action='+Constants.Championship.CHAMP_INFO+'&strategyid='+currstrategy.strategyid,
                        error:function(){
                              alert("error occured!!!");
                        },
                        success:  function(data) {
                            if(data.status == 'success'){
                                var champ = data.champ;
                                $('#strategytitle').text(champ.name + " ("+data.champinfo.nickname+")");
                                var t=data.champinfo.position+"*";
                                if(data.champinfo.position == 0)t = 'Undefined*';
                            
                            $('#s-ranking').html(t);
                            $('#s-prize').html(champ['prize']);
                            $('#s-cstartdate').html(champ['startdate']);
                            $('#s-cenddate').html(champ['enddate']);
                            $('#champ-link').append('<div class="btn-blue" style="font-size:10px !important; margin:5px;float:right;" onClick="loadContentTabParam(\'contest/contest.html\',$(\'#content-area\'),'+data.champinfo.championshipid+')">Go to Contest Page</div>');
                           // $('#champ-block').append(');
                            
                       
                       

                                        }
                                    }
                            });
                
            }
            
            //$('#sh-title').html("Highlight: "+currstrategy.strategyname);
                    $.ajax({
                        type: "post",
                        url: "publicdatahandle",
                        dataType: "json",
                        data:'action='+Constants.PublicData.SUMMARY+'&strategyid='+currstrategy.strategyid,
                        error:function(){
                              alert("error occured!!!");
                        },
                        success:  function(series) {
                            
                            
                            createSummaryTable(series.statistics);
                            //createDynamicTable($("#additionaldetails"), series.additional, false, true);
                            createDynamicTable($("#mreturn"), series.mreturn, true, true);

                          
                           // generates graphs
                           var dd = $.plot($("#dd"), [{data:series.drawdown, label: "Drawdown :  0.00"}], { xaxis: { mode: "time" }, crosshair:{mode:"x"}, grid: { hoverable: true, autoHighlight: false } });
                            //var legends = $("#dd .legendLabel");
                              //  legends.each(function () {
                                // fix the widths so they don't jump around
                              //  $(this).css('width', $(this).width());
                            //});
                            var updateLegendTimeout = null;
                            var latestPosition = null;

                            function updateLegend(pos, obj, l) {
                                updateLegendTimeout = null;
                                //legends = $("obj .legendLabel");
                                //var pos = latestPosition;

                                var axes = obj.getAxes();
                                if (pos.x < axes.xaxis.min || pos.x > axes.xaxis.max ||
                                    pos.y < axes.yaxis.min || pos.y > axes.yaxis.max)
                                    return;

                                var i, j, dataset = obj.getData();
                                for (i = 0; i < dataset.length; ++i) {
                                    var series = dataset[i];

                                    // find the nearest points, x-wise
                                    for (j = 0; j < series.data.length; ++j)
                                        if (series.data[j][0] >= pos.x)
                                            break;

                                    // now interpolate
                                    /*var y, p1 = series.data[j - 1], p2 = series.data[j];
                                    if (p1 == null)
                                        y = p2[1];
                                    else if (p2 == null)
                                        y = p1[1];
                                    else
                                        y = p1[1] + (p2[1] - p1[1]) * (pos.x - p1[0]) / (p2[0] - p1[0]);
                                        */
                                       var p = series.data[j];
                                       var now = new Date(p[0]);
                                    l.eq(i).text(series.label.replace(/:.*/, ": " + p[1].toFixed(2) + ' ('+now.toDateString()+')'));
                                    
                                }
                            }

                            $("#dd").bind("plothover",  function (event, pos, item) {
                                var l = $("#dd .legendLabel");
                                updateLegend(pos, dd, l);
                                
                            });






                           var cash = $.plot($("#cash-eq"), [{data:series.cash, label:"Cash : 0.0"},{data:series.eq, label:"Total Value : 0.0"}], { xaxis: { mode: "time" }, crosshair:{mode:"x"}, grid: { hoverable: true, autoHighlight: false } });
                           $("#cash-eq").bind("plothover",  function (event, pos, item) {
                               var l = $("#cash-eq .legendLabel");
                                updateLegend(pos, cash, l);
                            });


                           $.plot($("#sector"), series.sector,
                                            {
                                                    series: {
                                                        pie: {
                                                            show: true,
                                                            radious:1/4
                                                        }
                                                    },
                                                    legend: {
                                                        show: false
                                                    }
                                            });

                            // Open up the dialog with summary
                            //$( "#summary-dialog" ).dialog( "open" );
                        }
                    });
    function createSummaryTable(data){
        // [field, header, format]
       
           $('#s-overallreturn').html(colorFormat(data['overallreturn']));
           $('#s-3mreturn').html(colorFormat(data['3mreturn']));
           $('#s-profitfactor').html(colorFormat(data['profitfactor']));
           $('#s-avgwin').html(colorFormat(data['avgwin']));
           $('#s-avgloss').html(colorFormat(data['avgloss']));
           $('#s-tradecount').html(data['tradecount']);
           $('#s-profittradecount').html(data['profittradecount']);
           $('#s-loosingtradecount').html(data['loosingtradecount']);
           $('#s-maxdrawdown').html(colorFormat(data['maxdrawdown']));
           $('#s-age').html(data['age']);
         
      
           
           $('#s-strategist').html(data['nickname']);
           $('#s-currency').html(Constants.Currency.CURRENCY_CODE[data['currency']]);
           $('#s-market').html(Constants.Market.MARKET_CODE[data['market']]);
           $('#s-instrument').html(Constants.Instrument.INSTRUMENT_CODE[data['instrumentoptions']]);
           $('#s-initialbalance').html(parseFloat(data['initialbalance']).formatMoney(2, '.', ','));
          $('#s-currentbalance').html(parseFloat(data['balance']).formatMoney(2, '.', ','));
           $('#s-started').html( dateFormatter(data['started']) );
           $('#s-followers').html(data['followers']);
    /*   for(var i=0;i<fieldset2.length;i++){
           var trow = $("<tr>");
           $("<td>").html("<span style='font-size:1.2em'>"+fieldset2[i][1]+'</span>')
                    .addClass("ui-state-default")
                    .appendTo(trow);
           if(fieldset2[i][2] =='2')
               fieldFormatter(fieldset2[i][2], getKey(fieldset2[i][0], data[fieldset2[i][0]])).appendTo(trow);
           else
                fieldFormatter(fieldset2[i][2], data[fieldset2[i][0]]).appendTo(trow);
           trow.appendTo($("#additionaldetails"));

       }*/
       
       if(data['desc-block']!=null || data['description'] != ''){
               $('#desc-block').show();
               $('#desc-block').text(data['description']);
           }
       if(data['listingtype'] == Constants.Strategy.LISTING_PUBLIC)
       {
           $('#sub-block').show();
            if(data['fee'] > 0){
               $('#sub-tab').show();
               $('#s-trial').html(data['freetrial']);
               $('#s-fee').html(data['fee']);
            }else{
                $('#free-block').show();
            }
           
           
           if(currstrategy.relation == Constants.Strategy.PUBLIC ||
                    currstrategy.relation == Constants.Strategy.WATCHER){
           
               
           
           $('#s-follow').append('<div id="bfollow-sum" class="btn-green" style="margin-left:60px;margin-bottom:10px;">Start Following</div>');
                       $('#bfollow-sum').click(function(e){
                                            e.preventDefault();
                                            $('#bfollow').click();
                                        });
           }
       }
       
      
    
    }
    
    function createDynamicTable(tbody, data, row, col) {

                 if (tbody == null || tbody.length < 1) return;

                 for (var r = 0; r < data.length; r++) {
                     var trow = $("<tr>");
                     var drow = data[r];
                     
                     for (var c = 0; c < drow.length; c++) {
                        
                        var td = $("<td>");
                        
                        if((row&&r == 0) || (col&&c == 0))
                            td.html(drow[c]).addClass("cellheader");
                        else if(drow[c] != null && drow[c] != 'null')
                            td.html(colorFormat(drow[c])).addClass("cellformat");
                        
                        td.appendTo(trow);

                     }
                     trow.appendTo(tbody);
                 }
             }
           
        });

        </script>